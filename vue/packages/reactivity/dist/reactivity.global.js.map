{
  "version": 3,
  "sources": ["../src/index.ts", "../../../node_modules/.pnpm/registry.npmmirror.com+lodash-es@4.17.21/node_modules/lodash-es/isObject.js", "../src/effect.ts", "../src/baseHandler.ts", "../src/reactivity.ts"],
  "sourcesContent": ["export { reactive } from './reactivity'\n", "/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n", "import { Fn } from './types'\n\nfunction cleanEffect(effect: ReactiveEffect) {\n  const { deps } = effect\n  deps.forEach((item) => item.delete(effect))\n}\n\nexport let activeEffect: ReactiveEffect | null = null\nexport class ReactiveEffect {\n  // \u662F\u5426\u4E3A\u6FC0\u6D3B\u72B6\u6001\uFF1A\u53EF\u4EE5\u6267\u884C\u4F9D\u8D56\u6536\u96C6\n  public active = true\n  // \u591A\u5BF9\u591A\u7684\u5173\u7CFB\n  public deps: any[] = []\n  public parent: ReactiveEffect | null = null\n\n  constructor(public fn: Fn) {}\n\n  run() {\n    if (!this.active) {\n      this.fn()\n      return\n    }\n\n    this.parent = activeEffect\n    activeEffect = this\n\n    try {\n      cleanEffect(this)\n      return this.fn()\n    } finally {\n      activeEffect = this.parent\n      this.parent = null\n    }\n  }\n\n  stop() {\n    this.active = false\n  }\n}\n\nexport function effect(fn: Fn) {\n  // \u53EF\u4EE5\u5D4C\u5957\n  const _effect = new ReactiveEffect(fn)\n  _effect.run()\n}\n\nconst targetMap = new WeakMap<any, Map<any, Set<any>>>()\nexport function track(target, type, key) {\n  if (!activeEffect) return\n\n  let depsMap = targetMap.get(target)!\n  if (!depsMap) {\n    targetMap.set(target, (depsMap = new Map()))\n  }\n\n  let dep = depsMap.get(key)\n  if (!dep) {\n    depsMap.set(key, (dep = new Set()))\n  }\n  const shouldTrack = !dep.has(activeEffect)\n  if (shouldTrack) {\n    dep.add(activeEffect)\n    activeEffect.deps.push(dep)\n  }\n}\n\nexport function trigger(target, type, key, newValue, oldValue) {\n  const depsMap = targetMap.get(target)\n  if (!depsMap) return\n\n  const effects = depsMap.get(key)\n  if (effects) {\n    const clonedEffects = new Set(effects)\n    clonedEffects.forEach((effect) => {\n      if (activeEffect !== effect) effect.run()\n    })\n  }\n}\n", "import { track, trigger } from './effect'\n\nexport const enum REACTIVE_FLAGS {\n  IS_REACTIVE = '__v_is_reactive',\n}\n\nexport const baseHandler = {\n  get(target, key, receiver) {\n    if (key === REACTIVE_FLAGS.IS_REACTIVE) return true\n    const res = Reflect.get(target, key, receiver)\n    track(target, 'get', key)\n    return res\n  },\n  set(target, key, value, receiver) {\n    const oldValue = Reflect.get(target, key, receiver)\n    const result = Reflect.set(target, key, value, receiver)\n    if (oldValue !== value) {\n      trigger(target, 'set', key, value, oldValue)\n    }\n    return result\n  },\n}\n", "import { isObject } from 'lodash-es'\nimport { baseHandler, REACTIVE_FLAGS } from './baseHandler'\n\nconst reactiveMap = new WeakMap()\nexport function reactive<T>(target: T): T {\n  if (!isObject(target)) {\n    return target\n  }\n\n  const existingProxy = reactiveMap.get(target)\n  // console.log('existingProxy: ', existingProxy)\n  if (existingProxy) {\n    return existingProxy\n  }\n  if (target[REACTIVE_FLAGS.IS_REACTIVE]) {\n    return target\n  }\n\n  const proxy = new Proxy(target, baseHandler)\n  reactiveMap.set(target, proxy)\n  return proxy\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;;;ACyBA,WAAS,SAAS,OAAO;AACvB,QAAI,OAAO,OAAO;AAClB,WAAO,SAAS,SAAS,QAAQ,YAAY,QAAQ;AAAA,EACvD;AAEA,MAAO,mBAAQ;;;ACvBR,MAAI,eAAsC;AAuCjD,MAAM,YAAY,oBAAI,QAAiC;AAChD,WAAS,MAAM,QAAQ,MAAM,KAAK;AACvC,QAAI,CAAC;AAAc;AAEnB,QAAI,UAAU,UAAU,IAAI,MAAM;AAClC,QAAI,CAAC,SAAS;AACZ,gBAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,IAC7C;AAEA,QAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,QAAI,CAAC,KAAK;AACR,cAAQ,IAAI,KAAM,MAAM,oBAAI,IAAI,CAAE;AAAA,IACpC;AACA,UAAM,cAAc,CAAC,IAAI,IAAI,YAAY;AACzC,QAAI,aAAa;AACf,UAAI,IAAI,YAAY;AACpB,mBAAa,KAAK,KAAK,GAAG;AAAA,IAC5B;AAAA,EACF;AAEO,WAAS,QAAQ,QAAQ,MAAM,KAAK,UAAU,UAAU;AAC7D,UAAM,UAAU,UAAU,IAAI,MAAM;AACpC,QAAI,CAAC;AAAS;AAEd,UAAM,UAAU,QAAQ,IAAI,GAAG;AAC/B,QAAI,SAAS;AACX,YAAM,gBAAgB,IAAI,IAAI,OAAO;AACrC,oBAAc,QAAQ,CAAC,WAAW;AAChC,YAAI,iBAAiB;AAAQ,iBAAO,IAAI;AAAA,MAC1C,CAAC;AAAA,IACH;AAAA,EACF;;;ACvEO,MAAM,cAAc;AAAA,IACzB,IAAI,QAAQ,KAAK,UAAU;AACzB,UAAI,QAAQ;AAA4B,eAAO;AAC/C,YAAM,MAAM,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAC7C,YAAM,QAAQ,OAAO,GAAG;AACxB,aAAO;AAAA,IACT;AAAA,IACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAChC,YAAM,WAAW,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAClD,YAAM,SAAS,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AACvD,UAAI,aAAa,OAAO;AACtB,gBAAQ,QAAQ,OAAO,KAAK,OAAO,QAAQ;AAAA,MAC7C;AACA,aAAO;AAAA,IACT;AAAA,EACF;;;AClBA,MAAM,cAAc,oBAAI,QAAQ;AACzB,WAAS,SAAY,QAAc;AACxC,QAAI,CAAC,iBAAS,MAAM,GAAG;AACrB,aAAO;AAAA,IACT;AAEA,UAAM,gBAAgB,YAAY,IAAI,MAAM;AAE5C,QAAI,eAAe;AACjB,aAAO;AAAA,IACT;AACA,QAAI,6CAAoC;AACtC,aAAO;AAAA,IACT;AAEA,UAAM,QAAQ,IAAI,MAAM,QAAQ,WAAW;AAC3C,gBAAY,IAAI,QAAQ,KAAK;AAC7B,WAAO;AAAA,EACT;",
  "names": []
}
